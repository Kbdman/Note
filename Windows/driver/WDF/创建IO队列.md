# 创建I/O队列

大部分驱动在它们的EvtDriverDeviceAdd回调函数中创建I/O队列.驱动需要调用WdfIoQueueCreaye方法要为一个设备创建一个I/O队列。驱动需要提供一个WDF_IO_QUEUE_CONFIG作为参数。这个结构中包含了队列的设置信息，例如队列分发方法。这个结构同时也指明了这个队列是否是电源托管的，或者驱动是否为队列中的I/O请求支持0长度的Buffer

如果驱动将WDF_IO_QUEUE_CONFIG结构的DefaultQueue成员设置为TRUE，创建的队列将成为设备的默认I/O队列。如果驱动创建了一个默认的I/O队列，驱动将会将设备的所有I/O请求放在该队列中，触发创建了其他的队列来接受一些请求。驱动可以通过调用WdfDeviceGetDefaultQueue方法来获取一个设备的默认队列


如果想为一个设备使用多个I/O队列，驱动可以调用WdfIoQueueCreate来创建所需的队列。如果一个驱动创建了多个队列，它可以使用WdfDeviceConfigureRequestDispatching来控制框架将不统的请求发送到不统的队列。例如，可以让所有的读请求放入一个队列，而所有的写请求放入另一个队列

如果驱动创建了一组I/O队列并调用WdfDeviceConfigureRequestDispatching来定向驱动可能收到的每种请求到指定的队列，则驱动不需要一个默认队列

如果驱动没有为特定类型的请求提供I/O队列，并且你的驱动时一个功能驱动，框架会以STATUS_INVALID_DEVICE_REQUEST的状态来完成这种请求。如果时一个过滤驱动，并且已经调用了WdfFdoInitSetFilter,框架会自动将这些请求交给驱动栈中的下层驱动。因此，例如，一个不处理读请求的过滤驱动，不需要为读请求提供队列。

